--- source/hb_ssh2.c.orig	2025-06-25 15:52:11.000000000 +0200
+++ source/hb_ssh2.c	2025-11-06 01:01:33.166790265 +0100
@@ -5,6 +5,337 @@
  * www - http://www.kresin.ru
  */
 
+/* OS socket header inclusion borrowed from Harbour's hbsocket.c [alcz] */
+
+/*
+ * Socket C API
+ *
+ * Copyright 2009 Przemyslaw Czerpak <druzus / at / priv.onet.pl>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; see the file LICENSE.txt.  If not, write to
+ * the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+ * Boston, MA 02110-1301 USA (or visit https://www.gnu.org/licenses/).
+ *
+ * As a special exception, the Harbour Project gives permission for
+ * additional uses of the text contained in its release of Harbour.
+ *
+ * The exception is that, if you link the Harbour libraries with other
+ * files to produce an executable, this does not by itself cause the
+ * resulting executable to be covered by the GNU General Public License.
+ * Your use of that executable is in no way restricted on account of
+ * linking the Harbour library code into it.
+ *
+ * This exception does not however invalidate any other reasons why
+ * the executable file might be covered by the GNU General Public License.
+ *
+ * This exception applies only to the code released by the Harbour
+ * Project under the name Harbour.  If you copy code from other
+ * Harbour Project or Free Software Foundation releases into a copy of
+ * Harbour, as the General Public License permits, the exception does
+ * not apply to the code that you add in this way.  To avoid misleading
+ * anyone as to the status of such modified files, you must delete
+ * this exception notice from them.
+ *
+ * If you write modifications of your own for Harbour, it is your choice
+ * whether to permit this exception to apply to your modifications.
+ * If you do not wish that, delete this exception notice.
+ *
+ */
+
+#include "hbsocket.h"
+
+#if ( defined( HB_OS_DOS ) && ! defined( HB_HAS_WATT ) ) || \
+   defined( HB_OS_SYMBIAN ) || defined( __TINYC__ )
+#  if ! defined( HB_SOCKET_OFF )
+#     define HB_SOCKET_OFF
+#  endif
+#endif
+
+#if ! defined( HB_SOCKET_OFF )
+
+/* we do not use autoconf so we can only guess what is supported
+ * by platform and/or CRTL :-(
+ */
+/* we are using following macros:
+
+   platform supports inet_aton() function:
+      #define HB_HAS_INET_ATON
+
+   platform supports inet_pton() function:
+      #define HB_HAS_INET_PTON
+
+   platform supports inet_ntop() function:
+      #define HB_HAS_INET_NTOP
+
+   platform supports thread safe (using TLS) inet_ntoa() function:
+      #define HB_IS_INET_NTOA_MT_SAFE
+
+   platform supports getaddrinfo()/freeaddrinfo() functions:
+      #define HB_HAS_ADDRINFO
+
+   platform supports getnameinfo() function:
+      #define HB_HAS_NAMEINFO
+
+   platform supports gethostbyaddr function:
+      #define HB_HAS_GETHOSTBYADDR
+
+   platform supports poll() function:
+      #define HB_HAS_POLL
+
+   platform uses sockaddr structure which contains sa_len member:
+      #define HB_HAS_SOCKADDR_SA_LEN
+
+   platform supports constant inet6 addresses in6addr_any and in6addr_loopback:
+      #define HB_HAS_INET6_ADDR_CONST
+
+   platform supports IP6 protocol:
+      #define HB_HAS_INET6
+
+   platform supports unix/local protocol:
+      #define HB_HAS_UNIX
+
+   platform supports 'struct sockaddr_storage' which can be used as holder
+   for all socket address structures in all supported protocols,
+   simple 'struct sockaddr' is not large enough for such usage:
+      #define HB_HAS_SOCKADDR_STORAGE
+
+   timeval parameter used in Select() function is updated by kernel/CRTL
+   and decreased by the amount of time the function was waiting:
+      #define HB_HAS_SELECT_TIMER
+
+   all implementations should use BSD compatible constant values but
+   if it's not guarantied then these two macros can be used.
+   protocol families have to be translated:
+      #define HB_SOCKET_TRANSLATE_DOMAIN
+
+   protocol types have to be translated:
+      #define HB_SOCKET_TRANSLATE_TYPE
+*/
+
+#if defined( HB_OS_HPUX )
+#  define _XOPEN_SOURCE_EXTENDED
+#endif
+
+#if defined( HB_OS_UNIX )
+#  define HB_HAS_UNIX
+#  if defined( __WATCOMC__ )
+#     if __WATCOMC__ >= 1300
+#        define HB_HAS_INET_ATON
+#        define HB_HAS_GETHOSTBYADDR
+#     endif
+#  else
+#     define HB_HAS_INET_ATON
+#     define HB_HAS_INET_PTON
+#     define HB_HAS_INET_NTOP
+#     define HB_HAS_SOCKADDR_STORAGE
+#     define HB_HAS_ADDRINFO
+#     define HB_HAS_NAMEINFO
+#     define HB_HAS_GETHOSTBYADDR
+#     if ! defined( HB_HAS_POLL ) && ! defined( HB_NO_POLL ) && \
+         defined( _POSIX_C_SOURCE ) && _POSIX_C_SOURCE >= 200112L
+         /* use poll() instead of select() to avoid FD_SETSIZE (1024 in Linux)
+            file handle limit */
+#        define HB_HAS_POLL
+#     endif
+#  endif
+#  if ! defined( __WATCOMC__ ) && ! defined( HB_OS_BEOS ) && ! defined( HB_OS_MINIX )
+#     define HB_HAS_INET6
+#     if ! defined( HB_OS_VXWORKS )
+#        define HB_HAS_INET6_ADDR_CONST
+#     endif
+#  endif
+#  if defined( HB_OS_BEOS )
+#     define HB_SOCKET_TRANSLATE_DOMAIN
+#     define HB_SOCKET_TRANSLATE_TYPE
+#     define HB_HAS_SOCKADDR_SA_LEN
+#  endif
+#  if defined( HB_OS_LINUX )
+#     define HB_HAS_SELECT_TIMER
+#     if defined( HB_CPU_MIPS )
+#        define HB_SOCKET_TRANSLATE_TYPE
+#     endif
+#  endif
+#  if defined( HB_OS_SUNOS )
+#     if ! defined( BSD_COMP )
+#        define BSD_COMP
+#     endif
+#     define HB_SOCKET_TRANSLATE_DOMAIN
+#     define HB_SOCKET_TRANSLATE_TYPE
+#  endif
+#  if defined( HB_OS_BSD )
+#     define HB_SOCKET_TRANSLATE_DOMAIN
+#     define HB_HAS_SOCKADDR_SA_LEN
+#  endif
+#elif defined( HB_OS_WIN )
+#  if defined( __WATCOMC__ )
+#     if ( NTDDI_VERSION >= 0x06000000 ) && ! defined( HB_WINSOCK_USE_OLDFUNC )
+#        define HB_HAS_INET_PTON
+#        define HB_HAS_INET_NTOP
+#     endif
+#     define HB_HAS_SOCKADDR_STORAGE
+/* #     define HB_HAS_INET6 */
+#  elif defined( __MINGW32__ )
+#     define HB_HAS_SOCKADDR_STORAGE
+#  elif defined( __POCC__ ) && ! defined( __XCC__ )
+#     define HB_HAS_SOCKADDR_STORAGE
+#  elif defined( _MSC_VER )
+#     if _MSC_VER >= 1800 && ! defined( HB_WINSOCK_USE_OLDFUNC )
+#        define HB_HAS_INET_PTON
+#        define HB_HAS_INET_NTOP
+#        define HB_HAS_ADDRINFO
+#        define HB_HAS_NAMEINFO
+#     else
+#        define _WINSOCK_DEPRECATED_NO_WARNINGS
+#     endif
+#  endif
+#  define HB_IS_INET_NTOA_MT_SAFE
+#  define HB_HAS_GETHOSTBYADDR
+#  define hb_socketSetResolveError( err ) hb_socketSetOsError( err )
+#elif defined( HB_OS_OS2 )
+#  if defined( __WATCOMC__ )
+#     define HB_HAS_INET_PTON
+#     define HB_HAS_INET_NTOP
+#     define HB_HAS_SOCKADDR_SA_LEN
+#  else
+#     if ! defined( TCPV40HDRS )
+#        define HB_HAS_INET_ATON
+#        define HB_HAS_INET_PTON
+#        define HB_HAS_INET_NTOP
+#        define HB_HAS_SOCKADDR_SA_LEN
+#     endif
+#  endif
+#  define HB_HAS_GETHOSTBYADDR
+#elif defined( HB_OS_DOS )
+#  define HB_HAS_INET_ATON
+#  define HB_HAS_INET_PTON
+#  define HB_HAS_INET_NTOP
+#  define HB_HAS_SOCKADDR_STORAGE
+#  define HB_HAS_ADDRINFO
+#  define HB_HAS_NAMEINFO
+#  define HB_HAS_GETHOSTBYADDR
+#  define HB_HAS_INET6_ADDR_CONST
+/* #  define HB_HAS_INET6 */
+#endif
+
+#if defined( HB_HAS_NAMEINFO ) && ! defined( HB_HAS_ADDRINFO )
+#  undef HB_HAS_NAMEINFO
+#endif
+
+
+#if defined( HB_OS_WIN )
+#  include <winsock2.h>
+#  include <ws2tcpip.h>
+#  if ! defined( __DMC__ )
+#     include <iphlpapi.h>
+#  endif
+#else
+#  include <errno.h>
+#  if defined( HB_OS_DOS )
+#     if defined( __WATCOMC__ )
+         /* workaround for declaration conflicts in tcp.h */
+#        define _GETOPT_H
+#     endif
+#     include <tcp.h>
+#  elif defined( HB_OS_OS2 )
+#     if defined( __WATCOMC__ )
+#        include <types.h>
+#        include <nerrno.h>
+#     endif
+#     include <sys/socket.h>
+#     include <sys/select.h>
+#     include <arpa/inet.h>
+#  endif
+#  if ! ( defined( HB_OS_DOS ) && defined( __WATCOMC__ ) )
+#     include <sys/time.h>
+#  endif
+#  include <sys/types.h>
+#  include <sys/socket.h>
+#  include <sys/ioctl.h>
+#  if defined( HB_OS_BSD )
+#     include <ifaddrs.h>
+#     include <net/if_dl.h>
+#  endif
+#  if defined( HB_OS_BEOS )
+#     include <sys/sockio.h>
+#  endif
+#  if defined( HB_OS_VXWORKS )
+#     include <sockLib.h>
+#     include <ioLib.h>
+#  endif
+#  include <netdb.h>
+#  include <netinet/in.h>
+#  include <arpa/inet.h>
+#  if defined( HB_HAS_UNIX )
+#     include <sys/un.h>
+#  endif
+#  if defined( HB_HAS_POLL )
+#     include <poll.h>
+#  endif
+#  include <netinet/tcp.h>
+#  if ! ( defined( HB_OS_LINUX ) && defined( __WATCOMC__ ) )
+#     include <net/if.h>
+#  endif
+#  include <unistd.h>
+#  include <fcntl.h>
+#  if defined( HB_OS_DOS )
+#     define select          select_s
+#  endif
+#endif
+
+#if defined( HB_OS_OS2 ) || defined( HB_OS_WIN ) || defined( HB_OS_DOS ) || \
+    defined( HB_OS_VXWORKS )
+#  define socklen_t int
+#endif
+
+#if ! defined( INET_ADDRSTRLEN )
+#  define INET_ADDRSTRLEN  16
+#endif
+
+#if defined( HB_OS_DOS ) && ! defined( SHUT_RD )
+#  define SHUT_RD       0
+#  define SHUT_WR       1
+#  define SHUT_RDWR     2
+#endif
+
+#if defined( __WATCOMC__ ) && defined( HB_OS_LINUX ) && ! defined( IP_ADD_MEMBERSHIP )
+   /* it's missed in OpenWatcom 1.8 Linux header files :-( */
+#  define IP_ADD_MEMBERSHIP   35
+   struct ip_mreq
+   {
+      struct in_addr imr_multiaddr;    /* IP multicast address of group */
+      struct in_addr imr_interface;    /* Local IP address of interface */
+   };
+#endif
+
+#if defined( __POCC__ ) && ( __POCC__ >= 500 ) && defined( HB_OS_WIN_64 )
+   /* FIXME: Bad workaround for the '__WSAFDIsSet unresolved' problem
+             in Pelles C 5.00.13 AMD64 mode, to make final executables
+             link at all. Some hbsocket.c features (or the whole module)
+             won't properly work though. [vszakats] */
+   #undef FD_ISSET
+   #define FD_ISSET( s, f ) ( 0 )
+#endif
+
+#if defined( HB_OS_WIN )
+   typedef SOCKET       HB_SOCKET_T;
+#else
+   typedef HB_SOCKET    HB_SOCKET_T;
+#endif
+
+#endif /* HB_SOCKET_OFF */
+
+
 #include "hb_ssh2.h"
 
 #define  BUFFSIZE   8192
